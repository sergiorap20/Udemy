<header class="encabezado navbar-fixed-top" role="banner" id="encabezado">
    <div class="container">
        <a href="index.html" class="logo">
            <img src="images/logo.svg" alt="Logo del sitio">
        </a>

        <button type="button" class="boton-buscar" data-toggle="collapse" data-target="#bloque-buscar" aria-expanded="false">
              <i class="fa fa-search" aria-hidden="true"></i>
          </button>

        <form action="#" id="bloque-buscar" class="collapse">
            <div class="contenedor-bloque-buscar">
                <!-- Con el keyUP -->
                <!-- <input type="text" placeholder="Buscar..." [(ngModel)]="buscador" name="buscar" (keyup)="get_Objetos()"> -->

                <input type="text" placeholder="Buscar..." [(ngModel)]="buscador" name="buscar">

                <input type="submit" value="Buscar" class="boton" (click)="get_Objetos();">
            </div>
        </form>

    </div>
</header>

<section>
    <div class="container">
        <div class="row">
            <div class="col-12 py-5">

                <label class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input"  name="mostrar_ofertas" id="mostrar_ofertas" [(ngModel)]="only_offerts">
                    <span class="custom-control-indicator"></span>
                    <span class="custom-control-description">Sólo mostrar productos con ofertas</span>
                </label>
            </div>

            <!-- Bloque que muestra todos los productos -->
            <!-- El ng container se usa como si fuera un div, pero no afecta nada a los estilos de la pagina ya que angular lo hace como si estuviera fuera del dom-->
            <ng-container *ngIf="!only_offerts">

                <div class="col-12 col-md-3 item" *ngFor="let items of objetos;let i = index;">

                    <!-- // CAROUSEL // -->

                    <!-- Modal -->
                    <div class="modal fade" [id]="'exampleModal' + i+1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" [id]="'exampleModalLabel' + i+1">Modal title</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">

                                    <div [id]="'carouselExampleIndicators' + i+1" class="carousel slide" data-ride="carousel">
                                        <ol class="carousel-indicators">
                                            <li [attr.data-target]="'#carouselExampleIndicators' + i+1" data-slide-to="0" class="active"></li>
                                            <li [attr.data-target]="'#carouselExampleIndicators' + i+1" data-slide-to="1"></li>
                                            <li [attr.data-target]="'#carouselExampleIndicators' + i+1" data-slide-to="2"></li>
                                            <li [attr.data-target]="'#carouselExampleIndicators' + i+1" data-slide-to="3"></li>

                                        </ol>
                                        <div class="carousel-inner">
                                            <div class="carousel-item active">

                                                <img class="d-block w-100" [src]="items | modificarValue: 'imagen-carousel1'" alt="First slide">
                                            </div>
                                            <div class="carousel-item">
                                                <img class="d-block w-100" [src]="items | modificarValue: 'imagen-carousel2'" alt="Second slide">
                                            </div>
                                            <div class="carousel-item">
                                                <img class="d-block w-100" [src]="items | modificarValue: 'imagen-carousel3'" alt="Third slide">
                                            </div>
                                            <div class="carousel-item">
                                                <img class="d-block w-100" [src]="items | modificarValue: 'imagen-carousel4'" alt="Fourth slide">
                                            </div>
                                        </div>
                                        <a class="carousel-control-prev" [href]="'#carouselExampleIndicators' + i+1" role="button" data-slide="prev">
                                            <span class="" aria-hidden="true"><i class="fa fa-chevron-left" aria-hidden="true"></i>
                                            </span>
                                            <span class="sr-only">Previous</span>
                                        </a>
                                        <a class="carousel-control-next" [href]="'#carouselExampleIndicators' + i+1" role="button" data-slide="next">
                                            <span class="" aria-hidden="true"><i class="fa fa-chevron-right" aria-hidden="true"></i>
                                            </span>
                                            <span class="sr-only">Next</span>
                                        </a>
                                    </div>

                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- //FIN CAROUSEL // -->



                    <br>
                    <div class="text-center">
                        <a [href]="items.DetailPageURL"><img [src]="items | modificarValue: 'imagen'" class="img-fluid" style="height:160px;" alt="imagen producto"></a>
                    </div>
                    <hr>

                    <!-- Button trigger modal carousel-->
                    <button type="button" class="btn btn-primary boton-carousel" data-toggle="modal" [attr.data-target]="'#exampleModal' + i+1">
                        Imagenes
                    </button>

                    <p style="font-style:italic;">{{items.ItemAttributes.Title}}</p>
                    <p><b>Categoría:</b> {{items.ItemAttributes.ProductGroup | modificarValue: 'categoria' }}</p>
                    <!-- <p><b>Color:</b> {{items.ItemAttributes.Color }}</p>
                        
                    Hago un ngIf que llama a la funcion comprobar oferta y le paso por parámetro el valor del array que dice el total de ofertas que hay de un objeto 
                        como el ngIf ya lo controla angular no hacer falta poner {{}} en el parametro
                    -->
                    <!--Como en los que no tienen ofertas solo existe hasta items.Offers.Offer y si le meto más que esto por parámetro da error y para el programa 
                        he tenido que hacer un pipe para el precio_normal que le pasa el value hasta items.Offers.Offer y comprueba 
                        si el array length del value es mayor de 3 ya que en los que no tienen oferta solo es 3 , si es 3 significa que no tiene oferta
                        y devuelvo flase , si es mayor que 3 significa que si tiene oferta y si existe el valor completo , por lo tanto devuelvo items.Offers.Offer.OfferListing.Price.FormattedPrice
                    
                        Esto lo tengo que hacer para que al pasarle el parametro precio_normal al metodo comrpobar oferta no me de error de que a veces el parámetro no existe
                    -->
                    <p>
                        <b>Precio normal:</b> {{items.ItemAttributes | modificarValue: 'precio_normal' }}
                    </p>

                    <p *ngIf="comprobarOferta(items | modificarValue: 'ofertas', items.ItemAttributes | modificarValue: 'precio_normal',items | modificarValue: 'precio_rebajado', items | modificarValue: 'precio_rebajado_segundaMano' )">
                        <b>Precio más bajo actual:</b> {{items | modificarValue: 'precio_rebajado'}}
                    </p>

                    <p>
                        <b>Precio más bajo de segunda mano:</b> {{items | modificarValue: 'precio_rebajado_segundaMano'}}
                    </p>
                    <!--Si no hay ofertas hago que se imprima este p -->
                    <p *ngIf="!comprobarOferta(items | modificarValue: 'ofertas',items.ItemAttributes | modificarValue: 'precio_normal', items | modificarValue: 'precio_rebajado', items | modificarValue: 'precio_rebajado_segundaMano')" class="text-danger">
                        No hay ofertas para este artículo
                    </p>
                    <a [href]="items.ItemLinks.ItemLink[3].URL" target="_blank" class="d-block">Ir a ofertas de este objeto en Amazon</a>

                    <a [href]="items.DetailPageURL" target="_blank" class="d-block">Detalles en Amazon</a>
                    <!--Creo un boton que llama a una funcion mostrarOcultar y le paso por parametro la variable
                        i+1 declarada en el ngfor , por lo tanto el parametro será igual al id de la ul
                        que creo despues -->
                    <button class="boton-caracteristicas" (click)="mostrarOcultar(i+1);"> Caracteristicas</button>
                    <!--Le añado un array al ul que será la variable i que declaro en el ngfor +1 
                        la variable i sera cada vez que se recorre el for un numero mas alto  -->
                    <div [id]="i+1" class="d-none">
                        <ul class="caracteristicas">
                            <!-- Muestro los tods datos de un array dentro del array de items-->
                            <!-- Hago un pipe que comprueba si el dato es un array o un string y transforma el string en array ya que el ngfor da error si no es array-->
                            <li *ngFor="let caracteristica of items.ItemAttributes.Feature | convertirArray">
                                {{caracteristica}}
                            </li>
                        </ul>
                    </div>
                </div>
            </ng-container>

            <!-- FIN BLOQUE///
                ///////////////-->

            <!-- Muestra solo los productos con ofertas-->
            <div class="row" *ngIf="only_offerts">
                <!-- El ng container se usa como si fuera un div, pero no afecta nada a los estilos de la pagina ya que angular lo hace como si estuviera fuera del dom-->
                <ng-container *ngFor="let items of objetos;let i = index;">
                    <div class="col-12 col-md-3 item" *ngIf="comprobarOferta(items | modificarValue: 'ofertas',items.ItemAttributes | modificarValue: 'precio_normal', items | modificarValue: 'precio_rebajado',items | modificarValue: 'precio_rebajado_segundaMano')">
                        <br>

                        <!-- // CAROUSEL // -->

                        <!-- Modal -->
                        <div class="modal fade" [id]="'exampleModal' + i+1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" [id]="'exampleModalLabel' + i+1">Modal title</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">

                                        <div [id]="'carouselExampleIndicators' + i+1" class="carousel slide" data-ride="carousel">
                                            <ol class="carousel-indicators">
                                                <li [attr.data-target]="'#carouselExampleIndicators' + i+1" data-slide-to="0" class="active"></li>
                                                <li [attr.data-target]="'#carouselExampleIndicators' + i+1" data-slide-to="1"></li>
                                                <li [attr.data-target]="'#carouselExampleIndicators' + i+1" data-slide-to="2"></li>
                                                <li [attr.data-target]="'#carouselExampleIndicators' + i+1" data-slide-to="3"></li>

                                            </ol>
                                            <div class="carousel-inner">
                                                <div class="carousel-item active">

                                                    <img class="d-block w-100" [src]="items | modificarValue: 'imagen-carousel1'" alt="First slide">
                                                </div>
                                                <div class="carousel-item">
                                                    <img class="d-block w-100" [src]="items | modificarValue: 'imagen-carousel2'" alt="Second slide">
                                                </div>
                                                <div class="carousel-item">
                                                    <img class="d-block w-100" [src]="items | modificarValue: 'imagen-carousel3'" alt="Third slide">
                                                </div>
                                                <div class="carousel-item">
                                                    <img class="d-block w-100" [src]="items | modificarValue: 'imagen-carousel4'" alt="Fourth slide">
                                                </div>
                                            </div>
                                            <a class="carousel-control-prev" [href]="'#carouselExampleIndicators' + i+1" role="button" data-slide="prev">
                                                <span class="" aria-hidden="true"><i class="fa fa-chevron-left" aria-hidden="true"></i>
                                                </span>
                                                <span class="sr-only">Previous</span>
                                            </a>
                                            <a class="carousel-control-next" [href]="'#carouselExampleIndicators' + i+1" role="button" data-slide="next">
                                                <span class="" aria-hidden="true"><i class="fa fa-chevron-right" aria-hidden="true"></i>
                                                </span>
                                                <span class="sr-only">Next</span>
                                            </a>
                                        </div>

                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- //FIN CAROUSEL // -->



                        <div class="text-center">
                            <a [href]="items.DetailPageURL"><img [src]="items | modificarValue: 'imagen'" class="img-fluid" style="height:160px;" alt="imagen producto"></a>
                        </div>
                        <hr>
                        <button type="button" class="btn btn-primary boton-carousel" data-toggle="modal" [attr.data-target]="'#exampleModal' + i+1">
                            Imagenes
                        </button>
                        <p style="font-style:italic;">{{items.ItemAttributes.Title}}</p>
                        <p><b>Categoría:</b> {{items.ItemAttributes.ProductGroup | modificarValue: 'categoria' }}</p>
                        <!-- <p><b>Color:</b> {{items.ItemAttributes.Color }}</p>
                                            
                                        Hago un ngIf que llama a la funcion comprobar oferta y le paso por parámetro el valor del array que dice el total de ofertas que hay de un objeto 
                                            como el ngIf ya lo controla angular no hacer falta poner {{}} en el parametro
                                        -->
                        <!--Como en los que no tienen ofertas solo existe hasta items.Offers.Offer y si le meto más que esto por parámetro da error y para el programa 
                                            he tenido que hacer un pipe para el precio_normal que le pasa el value hasta items.Offers.Offer y comprueba 
                                            si el array length del value es mayor de 3 ya que en los que no tienen oferta solo es 3 , si es 3 significa que no tiene oferta
                                            y devuelvo flase , si es mayor que 3 significa que si tiene oferta y si existe el valor completo , por lo tanto devuelvo items.Offers.Offer.OfferListing.Price.FormattedPrice
                                        
                                            Esto lo tengo que hacer para que al pasarle el parametro precio_normal al metodo comrpobar oferta no me de error de que a veces el parámetro no existe
                                        -->
                        <p>
                            <b>Precio normal:</b> {{items.ItemAttributes | modificarValue: 'precio_normal' }}
                        </p>

                        <p *ngIf="comprobarOferta(items | modificarValue: 'ofertas', items.ItemAttributes | modificarValue: 'precio_normal',items | modificarValue: 'precio_rebajado',items | modificarValue: 'precio_rebajado_segundaMano')">
                            <b>Precio más bajo actual :</b> {{items | modificarValue: 'precio_rebajado'}}
                        </p>

                        <p>
                            <b>Precio más bajo actual segunda mano:</b> {{items | modificarValue: 'precio_rebajado_segundaMano'}}
                        </p>

                        <a [href]="items.ItemLinks.ItemLink[3].URL" target="_blank" class="d-block">Ir a ofertas de este objeto en Amazon</a>

                        <a [href]="items.DetailPageURL" target="_blank" class="d-block">Detalles en Amazon</a>
                        <!--Creo un boton que llama a una funcion mostrarOcultar y le paso por parametro la variable
                                            i+1 declarada en el ngfor , por lo tanto el parametro será igual al id de la ul
                                            que creo despues -->
                        <button class="boton-caracteristicas" (click)="mostrarOcultar(i+1);"> Caracteristicas</button>
                        <!--Le añado un array al ul que será la variable i que declaro en el ngfor +1 
                                            la variable i sera cada vez que se recorre el for un numero mas alto  -->
                        <div [id]="i+1" class="d-none">
                            <ul class="caracteristicas">
                                <!-- Muestro los tods datos de un array dentro del array de items-->
                                <!-- Hago un pipe que comprueba si el dato es un array o un string y transforma el string en array ya que el ngfor da error si no es array-->
                                <li *ngFor="let caracteristica of items.ItemAttributes.Feature | convertirArray">
                                    {{caracteristica}}
                                </li>
                            </ul>
                        </div>
                    </div>
                </ng-container>

            </div>


        </div>
    </div>
</section>